generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String          @id @default(uuid())
  email           String          @unique
  passwordHash    String
  firstName       String
  lastName        String
  role            UserRole
  permissions     String[]
  isActive        Boolean         @default(true)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  lastLoginAt     DateTime?
  specialization  String?
  licenseNumber   String?
  employeeId      String?
  department      String?
  patientId       String?
  phone           String?         @unique
  address         String?
  profileImageUrl String?
  notifications   Notification[]
  passwordResets  PasswordReset[]
  staff           Staff?
  settings        UserSettings?
}

model PasswordReset {
  id        String   @id @default(uuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  used      Boolean  @default(false)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
}

model CollectionDoc {
  id         String
  collection String
  data       Json
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@id([collection, id])
  @@index([collection])
}

model Appointment {
  id              String            @id @default(uuid())
  dateTime        DateTime
  patient         String
  patientId       String?
  patientEmail    String?
  patientPhone    String?
  doctor          String
  doctorId        String?
  type            String
  duration        String
  status          AppointmentStatus @default(Confirmed)
  treatmentId     String?
  notes           String?
  bookedBy        String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  reason          String?
  urgency         String?
  confirmedAt     DateTime?
  confirmedBy     String?
  rejectedAt      DateTime?
  rejectionReason String?
  rejectedBy      String?
  treatment       Treatment?        @relation(fields: [treatmentId], references: [id])

  @@index([dateTime])
  @@index([status])
  @@index([treatmentId])
}

model Patient {
  id                String           @id @default(uuid())
  name              String
  lastName          String
  email             String           @unique
  phone             String           @unique
  dob               DateTime
  lastVisit         DateTime?
  status            PatientStatus    @default(Active)
  address           String?
  ecName            String?
  ecPhone           String?
  ecRelationship    String?
  insuranceProvider String?
  policyNumber      String?
  medicalHistory    Json?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  allergies         String[]
  bloodType         String?
  profilePhotoUrl   String?
  invoices          Invoice[]
  familyMembers     PatientFamily[]  @relation("PatientFamilyMembers")
  familyOf          PatientFamily[]  @relation("PatientFamilyRelatives")
  settings          PatientSettings?

  @@index([status])
  @@index([lastVisit])
}

model PatientFamily {
  id               String   @id @default(uuid())
  patientId        String
  relativeId       String
  relationship     String
  isPrimaryContact Boolean  @default(false)
  notes            String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  patient          Patient  @relation("PatientFamilyMembers", fields: [patientId], references: [id], onDelete: Cascade)
  relative         Patient  @relation("PatientFamilyRelatives", fields: [relativeId], references: [id], onDelete: Cascade)

  @@unique([patientId, relativeId])
  @@index([patientId])
  @@index([relativeId])
}

model Treatment {
  id           String          @id @default(uuid())
  patient      String
  patientId    String?
  doctor       String
  doctorId     String?
  procedure    String
  cost         String
  status       TreatmentStatus @default(Pending)
  notes        String?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  appointments Appointment[]
  invoices     Invoice[]

  @@index([status])
  @@index([patientId])
  @@index([doctorId])
}

model MedicalRecord {
  id         String              @id @default(uuid())
  patient    String
  patientId  String?
  type       String
  complaint  String?
  provider   String
  providerId String?
  date       DateTime            @default(now())
  status     MedicalRecordStatus @default(Final)
  notes      String?
  createdAt  DateTime            @default(now())
  updatedAt  DateTime            @updatedAt

  @@index([patientId])
  @@index([status])
  @@index([date])
}

model ClinicalImage {
  id          String   @id @default(uuid())
  patient     String
  patientId   String?
  type        String
  imageUrl    String
  caption     String?
  date        DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  toothNumber Int?

  @@index([patientId])
  @@index([date])
  @@index([toothNumber])
}

model DentalChart {
  id        String   @id @default(uuid())
  patientId String   @unique
  chartData Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([patientId])
}

model Staff {
  id                     String                  @id @default(uuid())
  userId                 String?                 @unique
  name                   String
  role                   String
  email                  String                  @unique
  phone                  String
  schedule               String
  salary                 String
  hireDate               DateTime
  status                 StaffStatus             @default(Active)
  notes                  String?
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt
  attendanceRecords      AttendanceRecord[]
  cashDrawerTransactions CashDrawerTransaction[]
  leaveRequests          LeaveRequest[]
  receptionShifts        ReceptionShift[]
  handoversFrom          ShiftHandover[]         @relation("HandoverFromStaff")
  handoversTo            ShiftHandover[]         @relation("HandoverToStaff")
  user                   User?                   @relation(fields: [userId], references: [id])

  @@index([status])
  @@index([role])
}

model Supplier {
  id             String          @id @default(uuid())
  name           String          @unique
  address        String?
  phone          String?
  email          String?
  category       String?
  paymentTerms   String?
  rating         Float?
  status         SupplierStatus  @default(Active)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  items          InventoryItem[]
  purchaseOrders PurchaseOrder[]

  @@index([status])
}

model InventoryItem {
  id           String              @id @default(uuid())
  name         String
  category     String?
  supplierId   String?
  quantity     Int                 @default(0)
  minQuantity  Int                 @default(0)
  maxQuantity  Int                 @default(0)
  unitCost     Decimal             @db.Decimal(12, 2)
  status       InventoryItemStatus @default(Normal)
  expires      DateTime?
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  location     String?
  supplierName String?
  supplier     Supplier?           @relation(fields: [supplierId], references: [id])
  medications  Medication[]

  @@index([status])
  @@index([category])
  @@index([quantity])
  @@index([expires])
}

model Medication {
  id              String             @id @default(uuid())
  name            String
  fullName        String?
  strength        String?
  form            String?
  category        String?
  stock           Int                @default(0)
  unitPrice       Decimal            @db.Decimal(12, 2)
  expiryDate      DateTime?
  status          MedicationStatus   @default(InStock)
  inventoryItemId String?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  inventoryItem   InventoryItem?     @relation(fields: [inventoryItemId], references: [id])
  dispensings     PharmacyDispense[]
  prescriptions   Prescription[]

  @@index([status])
  @@index([category])
}

model Prescription {
  id                String             @id @default(uuid())
  patientId         String?
  patientName       String
  doctorId          String?
  doctorName        String
  medicationId      String?
  medicationName    String
  strength          String?
  dosage            String?
  instructions      String?
  duration          String?
  refills           Int                @default(0)
  status            PrescriptionStatus @default(Active)
  invoiceId         String?
  treatmentId       String?
  dispensedAt       DateTime?
  dispensedQuantity Int?
  totalAmount       Decimal?           @db.Decimal(12, 2)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  dispensings       PharmacyDispense[]
  medication        Medication?        @relation(fields: [medicationId], references: [id])

  @@index([patientId])
  @@index([doctorId])
  @@index([status])
}

model PharmacyDispense {
  id             String        @id @default(uuid())
  prescriptionId String?
  medicationId   String?
  patientId      String?
  patientName    String
  doctorId       String?
  doctorName     String?
  quantity       Int
  unitPrice      Decimal       @db.Decimal(12, 2)
  totalAmount    Decimal       @db.Decimal(12, 2)
  invoiceId      String?
  treatmentId    String?
  notes          String?
  dispensedBy    String?
  dispensedAt    DateTime      @default(now())
  createdAt      DateTime      @default(now())
  medication     Medication?   @relation(fields: [medicationId], references: [id])
  prescription   Prescription? @relation(fields: [prescriptionId], references: [id])

  @@index([prescriptionId])
  @@index([medicationId])
}

model PurchaseOrder {
  id               String              @id @default(uuid())
  supplierId       String?
  supplierName     String
  status           PurchaseOrderStatus @default(Pending)
  total            Decimal             @db.Decimal(12, 2)
  orderDate        DateTime
  expectedDelivery DateTime?
  items            Json?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  supplier         Supplier?           @relation(fields: [supplierId], references: [id])

  @@index([supplierId])
  @@index([status])
}

model PharmacyTransaction {
  id                String                    @id @default(uuid())
  date              DateTime                  @default(now())
  description       String
  amount            Decimal                   @db.Decimal(12, 2)
  amountValue       Decimal                   @db.Decimal(12, 2)
  totalAmount       Decimal?                  @db.Decimal(12, 2)
  outstandingAmount Decimal?                  @db.Decimal(12, 2)
  type              PharmacyTransactionType
  category          String?
  status            PharmacyTransactionStatus @default(Completed)
  paymentMethod     String?
  patientId         String?
  patientName       String?
  sourceId          String?
  sourceType        String?
  metadata          Json?
  auto              Boolean                   @default(false)
  createdAt         DateTime                  @default(now())
  updatedAt         DateTime                  @updatedAt

  @@index([type])
  @@index([status])
  @@index([patientId])
}

model Invoice {
  id                   String        @id @default(uuid())
  number               String        @unique
  patientId            String?
  treatmentId          String?
  date                 DateTime
  dueDate              DateTime?
  amount               Decimal       @db.Decimal(12, 2)
  status               InvoiceStatus @default(Draft)
  notes                String?
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  createdBy            String?
  lastModifiedBy       String?
  paymentMethod        String?
  patientNameSnapshot  String?
  patientPhoneSnapshot String?
  amountPaid           Decimal       @default(0) @db.Decimal(12, 2)
  patient              Patient?      @relation(fields: [patientId], references: [id])
  treatment            Treatment?    @relation(fields: [treatmentId], references: [id])
  items                InvoiceItem[]

  @@index([patientId])
  @@index([treatmentId])
  @@index([status])
  @@index([dueDate])
}

model InvoiceItem {
  id          String  @id @default(uuid())
  invoiceId   String
  description String
  quantity    Int
  unitPrice   Decimal @db.Decimal(12, 2)
  total       Decimal @db.Decimal(12, 2)
  invoice     Invoice @relation(fields: [invoiceId], references: [id])
}

model ChatConversation {
  id            String                 @id @default(uuid())
  patientId     String?
  patientName   String
  patientEmail  String?
  staffId       String?
  staffName     String?
  status        ChatConversationStatus @default(Active)
  lastMessageAt DateTime               @default(now())
  createdAt     DateTime               @default(now())
  updatedAt     DateTime               @updatedAt
  messages      ChatMessage[]

  @@index([status])
  @@index([patientId])
  @@index([staffId])
  @@index([lastMessageAt])
}

model ChatMessage {
  id             String           @id @default(uuid())
  conversationId String
  senderType     String
  senderId       String?
  senderName     String
  message        String
  isRead         Boolean          @default(false)
  readAt         DateTime?
  createdAt      DateTime         @default(now())
  conversation   ChatConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([isRead])
  @@index([createdAt])
}

model PatientSettings {
  id                   String   @id @default(uuid())
  patientId            String?  @unique
  userId               String   @unique
  emailNotifications   Boolean  @default(true)
  smsNotifications     Boolean  @default(true)
  appointmentReminders Boolean  @default(true)
  promotionalEmails    Boolean  @default(false)
  language             String   @default("en")
  timezone             String   @default("Africa/Cairo")
  darkMode             Boolean  @default(false)
  twoFactorEnabled     Boolean  @default(false)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  patient              Patient? @relation(fields: [patientId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([patientId])
}

model UserSettings {
  id                   String   @id @default(uuid())
  userId               String   @unique
  emailNotifications   Boolean  @default(true)
  appointmentReminders Boolean  @default(true)
  systemAlerts         Boolean  @default(true)
  language             String   @default("en")
  timezone             String   @default("Africa/Cairo")
  darkMode             Boolean  @default(false)
  twoFactorEnabled     Boolean  @default(false)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model PortalContent {
  id        String   @id @default(uuid())
  type      String
  title     String?
  content   Json
  active    Boolean  @default(true)
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([type])
  @@index([active])
}

model ClinicSettings {
  id                  String   @id @default("main")
  clinicName          String   @default("")
  phoneNumber         String   @default("")
  email               String   @default("")
  website             String   @default("")
  address             String   @default("")
  businessHours       String   @default("mon-fri-8-6")
  timezone            String   @default("eastern")
  appointmentDuration String   @default("60")
  bookingLimit        String   @default("90")
  allowOnlineBooking  Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  faviconUrl          String?
  logoUrl             String?
  weeklySchedule      Json?
}

model Notification {
  id          String               @id @default(uuid())
  userId      String
  type        NotificationType
  title       String
  message     String
  relatedId   String?
  relatedType String?
  link        String?
  isRead      Boolean              @default(false)
  readAt      DateTime?
  priority    NotificationPriority @default(NORMAL)
  metadata    Json?
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  user        User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, isRead])
  @@index([createdAt])
  @@index([type])
}

model PatientMessage {
  id          String          @id @default(uuid())
  patientId   String
  patientName String
  type        MessageType     @default(Email)
  subject     String
  content     String
  snippet     String?
  status      MessageStatus   @default(Queued)
  priority    MessagePriority @default(normal)
  sentAt      DateTime?
  readAt      DateTime?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@index([patientId])
  @@index([status])
  @@index([type])
}

model InsuranceClaim {
  id                String               @id @default(uuid())
  patientId         String
  patientName       String
  insuranceProvider String
  policyNumber      String?
  procedure         String
  procedureCode     String?
  amount            Decimal              @db.Decimal(12, 2)
  approvedAmount    Decimal?             @db.Decimal(12, 2)
  status            InsuranceClaimStatus @default(Pending)
  submitDate        DateTime             @default(now())
  responseDate      DateTime?
  notes             String?
  treatmentId       String?
  invoiceId         String?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt

  @@index([patientId])
  @@index([status])
  @@index([submitDate])
}

model Referral {
  id                String          @id @default(uuid())
  patientId         String
  patientName       String
  specialty         String
  specialist        String
  reason            String
  urgency           ReferralUrgency @default(routine)
  status            ReferralStatus  @default(pending)
  referringDoctor   String?
  referringDoctorId String?
  referralDate      DateTime        @default(now())
  appointmentDate   DateTime?
  notes             String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  @@index([patientId])
  @@index([status])
  @@index([referralDate])
}

model ToothImageLink {
  id          String   @id @default(uuid())
  patientId   String
  patientName String
  imageId     String
  toothNumber Int
  condition   String?
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([patientId])
  @@index([imageId])
  @@index([toothNumber])
}

model Lab {
  id          String    @id @default(uuid())
  name        String    @unique
  address     String?
  phone       String?
  email       String?
  contactName String?
  specialty   String?
  rating      Float?
  isActive    Boolean   @default(true)
  notes       String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  cases       LabCase[]

  @@index([isActive])
}

model LabCase {
  id            String              @id @default(uuid())
  caseNumber    String              @unique
  labId         String?
  labName       String?
  patientId     String?
  patientName   String
  doctorId      String?
  doctorName    String
  treatmentId   String?
  caseType      String
  toothNumbers  String?
  shade         String?
  material      String?
  description   String?
  instructions  String?
  status        LabCaseStatus       @default(Draft)
  priority      LabCasePriority     @default(Normal)
  requestDate   DateTime            @default(now())
  dueDate       DateTime?
  sentToLabDate DateTime?
  receivedDate  DateTime?
  deliveredDate DateTime?
  estimatedCost Decimal?            @db.Decimal(12, 2)
  actualCost    Decimal?            @db.Decimal(12, 2)
  invoiceId     String?
  notes         String?
  createdBy     String?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  lab           Lab?                @relation(fields: [labId], references: [id])
  attachments   LabCaseAttachment[]
  updates       LabCaseUpdate[]

  @@index([labId])
  @@index([patientId])
  @@index([doctorId])
  @@index([status])
  @@index([priority])
  @@index([requestDate])
  @@index([dueDate])
}

model LabCaseAttachment {
  id          String   @id @default(uuid())
  caseId      String
  fileName    String
  fileUrl     String
  fileType    String
  fileSize    Int?
  description String?
  uploadedBy  String?
  createdAt   DateTime @default(now())
  case        LabCase  @relation(fields: [caseId], references: [id], onDelete: Cascade)

  @@index([caseId])
  @@index([fileType])
}

model LabCaseUpdate {
  id              String        @id @default(uuid())
  caseId          String
  status          LabCaseStatus
  message         String?
  updatedBy       String?
  isSharedWithLab Boolean       @default(false)
  createdAt       DateTime      @default(now())
  case            LabCase       @relation(fields: [caseId], references: [id], onDelete: Cascade)

  @@index([caseId])
  @@index([createdAt])
}

model AttendanceRecord {
  id                    String           @id @default(uuid())
  staffId               String
  date                  DateTime         @db.Date
  status                AttendanceStatus @default(Present)
  clockIn               DateTime?
  clockOut              DateTime?
  breakStart            DateTime?
  breakEnd              DateTime?
  totalBreakMinutes     Int?
  clockInLocation       Json?
  clockOutLocation      Json?
  locationVerified      Boolean          @default(false)
  scheduledHours        Decimal?         @db.Decimal(4, 2)
  workedHours           Decimal?         @db.Decimal(4, 2)
  overtimeHours         Decimal?         @db.Decimal(4, 2)
  lateMinutes           Int?
  earlyDepartureMinutes Int?
  notes                 String?
  approvedBy            String?
  approvedAt            DateTime?
  createdAt             DateTime         @default(now())
  updatedAt             DateTime         @updatedAt
  staff                 Staff            @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@unique([staffId, date])
  @@index([staffId])
  @@index([date])
  @@index([status])
}

model LeaveRequest {
  id            String      @id @default(uuid())
  staffId       String
  leaveType     LeaveType
  startDate     DateTime    @db.Date
  endDate       DateTime    @db.Date
  totalDays     Int
  reason        String?
  status        LeaveStatus @default(Pending)
  reviewedBy    String?
  reviewedAt    DateTime?
  reviewNotes   String?
  attachmentUrl String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  staff         Staff       @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@index([staffId])
  @@index([status])
  @@index([startDate])
  @@index([endDate])
}

model AttendanceSettings {
  id                      String   @id @default("main")
  workStartTime           String   @default("09:00")
  workEndTime             String   @default("17:00")
  lunchBreakMinutes       Int      @default(60)
  lateGraceMinutes        Int      @default(15)
  earlyLeaveGraceMinutes  Int      @default(15)
  overtimeEnabled         Boolean  @default(true)
  overtimeThresholdHours  Decimal  @default(8) @db.Decimal(4, 2)
  locationTrackingEnabled Boolean  @default(true)
  clinicLatitude          Decimal? @db.Decimal(10, 7)
  clinicLongitude         Decimal? @db.Decimal(10, 7)
  allowedRadiusMeters     Int      @default(100)
  workDays                String   @default("1,2,3,4,5")
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
}

model ReceptionShift {
  id                     String                  @id @default(uuid())
  staffId                String
  scheduledStart         DateTime
  scheduledEnd           DateTime
  actualStart            DateTime?
  actualEnd              DateTime?
  status                 ShiftStatus             @default(Active)
  shiftType              String                  @default("Regular")
  notes                  String?
  openingCashAmount      Decimal?                @db.Decimal(12, 2)
  closingCashAmount      Decimal?                @db.Decimal(12, 2)
  expectedCashAmount     Decimal?                @db.Decimal(12, 2)
  cashDiscrepancy        Decimal?                @db.Decimal(12, 2)
  cashDiscrepancyNotes   String?
  totalTransactions      Int                     @default(0)
  totalRevenue           Decimal?                @db.Decimal(12, 2)
  totalAppointments      Int                     @default(0)
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt
  cashDrawerTransactions CashDrawerTransaction[]
  staff                  Staff                   @relation(fields: [staffId], references: [id], onDelete: Cascade)
  handoversFrom          ShiftHandover[]         @relation("HandoverFromShift")
  handoversTo            ShiftHandover[]         @relation("HandoverToShift")

  @@index([staffId])
  @@index([status])
  @@index([scheduledStart])
  @@index([scheduledEnd])
}

model ShiftHandover {
  id              String          @id @default(uuid())
  fromStaffId     String
  toStaffId       String
  fromShiftId     String?
  toShiftId       String?
  handoverType    HandoverType    @default(Shift)
  status          HandoverStatus  @default(Pending)
  handoverTime    DateTime        @default(now())
  acceptedAt      DateTime?
  completedAt     DateTime?
  handoverNotes   String?
  acceptanceNotes String?
  pendingTasks    Json?
  importantNotes  Json?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  fromShift       ReceptionShift? @relation("HandoverFromShift", fields: [fromShiftId], references: [id])
  fromStaff       Staff           @relation("HandoverFromStaff", fields: [fromStaffId], references: [id], onDelete: Cascade)
  toShift         ReceptionShift? @relation("HandoverToShift", fields: [toShiftId], references: [id])
  toStaff         Staff           @relation("HandoverToStaff", fields: [toStaffId], references: [id], onDelete: Cascade)

  @@index([fromStaffId])
  @@index([toStaffId])
  @@index([status])
  @@index([handoverType])
  @@index([handoverTime])
}

model CashDrawerTransaction {
  id              String         @id @default(uuid())
  shiftId         String
  staffId         String
  type            String
  amount          Decimal        @db.Decimal(12, 2)
  previousBalance Decimal        @db.Decimal(12, 2)
  newBalance      Decimal        @db.Decimal(12, 2)
  cashAmount      Decimal?       @db.Decimal(12, 2)
  cardAmount      Decimal?       @db.Decimal(12, 2)
  otherAmount     Decimal?       @db.Decimal(12, 2)
  referenceId     String?
  referenceType   String?
  description     String?
  notes           String?
  verifiedBy      String?
  verifiedAt      DateTime?
  createdAt       DateTime       @default(now())
  shift           ReceptionShift @relation(fields: [shiftId], references: [id], onDelete: Cascade)
  staff           Staff          @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@index([shiftId])
  @@index([staffId])
  @@index([type])
  @@index([createdAt])
}

model PatientWallet {
  id                String              @id @default(uuid())
  patientId         String              @unique
  balance           Decimal             @default(0) @db.Decimal(12, 2)
  totalDeposits     Decimal             @default(0) @db.Decimal(12, 2)
  totalWithdrawals  Decimal             @default(0) @db.Decimal(12, 2)
  totalPayments     Decimal             @default(0) @db.Decimal(12, 2)
  totalRefunds      Decimal             @default(0) @db.Decimal(12, 2)
  isActive          Boolean             @default(true)
  autoPayEnabled    Boolean             @default(false)
  lowBalanceAlert   Decimal?            @db.Decimal(12, 2)
  patientName       String?
  patientPhone      String?
  patientEmail      String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  lastTransactionAt DateTime?
  transactions      WalletTransaction[]

  @@index([patientId])
  @@index([balance])
  @@index([isActive])
}

model WalletTransaction {
  id                 String                  @id @default(uuid())
  walletId           String
  type               WalletTransactionType
  status             WalletTransactionStatus @default(Completed)
  amount             Decimal                 @db.Decimal(12, 2)
  balanceBefore      Decimal                 @db.Decimal(12, 2)
  balanceAfter       Decimal                 @db.Decimal(12, 2)
  referenceId        String?
  referenceType      String?
  paymentMethod      String?
  description        String
  notes              String?
  processedBy        String?
  processedByName    String?
  createdAt          DateTime                @default(now())
  completedAt        DateTime?
  cancelledAt        DateTime?
  cancelledBy        String?
  cancellationReason String?
  wallet             PatientWallet           @relation(fields: [walletId], references: [id], onDelete: Cascade)

  @@index([walletId])
  @@index([type])
  @@index([status])
  @@index([referenceId])
  @@index([createdAt])
}

enum AppointmentStatus {
  Confirmed
  Pending
  Cancelled
  Completed
}

enum PatientStatus {
  Active
  Inactive
}

enum TreatmentStatus {
  Pending
  InProgress
  Completed
}

enum InvoiceStatus {
  Draft
  Sent
  Paid
  Overdue
  Cancelled
}

enum MedicalRecordStatus {
  Draft
  Final
}

enum UserRole {
  admin
  doctor
  receptionist
  patient
}

enum StaffStatus {
  Active
  Inactive
}

enum SupplierStatus {
  Active
  Inactive
}

enum InventoryItemStatus {
  Normal
  LowStock
  OutOfStock
}

enum MedicationStatus {
  InStock
  LowStock
  OutOfStock
}

enum PrescriptionStatus {
  Active
  Completed
}

enum PurchaseOrderStatus {
  Pending
  Shipped
  Delivered
  Cancelled
}

enum PharmacyTransactionType {
  Revenue
  Expense
}

enum PharmacyTransactionStatus {
  Pending
  Completed
}

enum ChatConversationStatus {
  Active
  Closed
  Archived
}

enum NotificationType {
  APPOINTMENT_PENDING
  APPOINTMENT_CONFIRMED
  APPOINTMENT_CANCELLED
  INVENTORY_LOW_STOCK
  INVENTORY_OUT_OF_STOCK
  MESSAGE_RECEIVED
  CHAT_MESSAGE
  SYSTEM
  REMINDER
}

enum NotificationPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum MessageType {
  Email
  SMS
  WhatsApp
  Call
}

enum MessageStatus {
  Sent
  Delivered
  Failed
  Queued
  Read
}

enum MessagePriority {
  low
  normal
  high
}

enum InsuranceClaimStatus {
  Processing
  Approved
  Denied
  Pending
}

enum ReferralStatus {
  pending
  scheduled
  completed
  cancelled
}

enum ReferralUrgency {
  routine
  urgent
  emergency
}

enum LabCaseStatus {
  Draft
  Submitted
  InProgress
  QualityCheck
  Completed
  Delivered
  Cancelled
}

enum LabCasePriority {
  Low
  Normal
  High
  Urgent
}

enum AttendanceStatus {
  Present
  Absent
  Late
  HalfDay
  OnLeave
  Holiday
  Weekend
}

enum LeaveType {
  Annual
  Sick
  Personal
  Unpaid
  Maternity
  Paternity
  Emergency
  Other
}

enum LeaveStatus {
  Pending
  Approved
  Rejected
  Cancelled
}

enum ShiftStatus {
  Active
  Completed
  Cancelled
}

enum HandoverType {
  Shift
  CashDrawer
  Emergency
}

enum HandoverStatus {
  Pending
  Accepted
  Rejected
  Completed
}

enum WalletTransactionType {
  Deposit
  Withdrawal
  Payment
  Refund
  Adjustment
  Transfer
}

enum WalletTransactionStatus {
  Pending
  Completed
  Failed
  Cancelled
  Refunded
}
